<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>位置エネルギー実験：2変数対照シミュレーター</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Meiryo', sans-serif; background: #121212; color: #eee; display: flex; }
        #sidebar { width: 360px; padding: 20px; background: #1e1e1e; height: 100vh; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.5); z-index: 10; }
        #viewport { flex-grow: 1; position: relative; }
        .control-card { background: #2d2d2d; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #444; }
        label { display: block; font-size: 0.85rem; margin-bottom: 10px; color: #bbb; }
        input[type="range"] { width: 100%; margin-bottom: 10px; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; transition: 0.3s; }
        #btn-drop { background: #ff4757; color: white; }
        #btn-drop:hover { background: #ff6b81; }
        #btn-clear { background: #57606f; color: white; }
        .chart-box { background: white; border-radius: 8px; padding: 10px; margin-top: 15px; }
        .chart-title { color: #333; font-size: 0.75rem; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .value-display { color: #fff; font-size: 1.1rem; font-weight: bold; float: right; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="font-size: 1.2rem; margin-top: 0;">実験パラメータ</h2>
    
    <div class="control-card">
        <label>質量 $m$: <span class="value-display" id="txt-mass">1.0</span> kg</label>
        <input type="range" id="range-mass" min="0.5" max="5.0" step="0.5" value="1.0">
        
        <label>高さ $h$: <span class="value-display" id="txt-height">5.0</span> m</label>
        <input type="range" id="range-height" min="1.0" max="10.0" step="1.0" value="5.0">
        
        <div class="btn-group">
            <button id="btn-drop">落下開始</button>
            <button id="btn-clear">データ消去</button>
        </div>
    </div>

    <div class="chart-box">
        <div class="chart-title">【実験1】質量 $m$ と沈み込みの関係</div>
        <canvas id="chartMass"></canvas>
    </div>

    <div class="chart-box">
        <div class="chart-title">【実験2】高さ $h$ と沈み込みの関係</div>
        <canvas id="chartHeight"></canvas>
    </div>
</div>

<div id="viewport"></div>

<script>
// --- 物理設定 ---
const G_ACCEL = 0.015; // シミュレーション上の重力
const RESISTANCE = 40; // 筒の中の円柱の抵抗係数

// --- Three.js 構築 ---
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(50, (window.innerWidth - 360) / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth - 360, window.innerHeight);
document.getElementById('viewport').appendChild(renderer.domElement);

// ライティング
scene.add(new THREE.AmbientLight(0x666666));
const sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(5, 10, 5);
scene.add(sun);

// 床とグリッド
const grid = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
scene.add(grid);

// 透明な筒
const tube = new THREE.Mesh(
    new THREE.CylinderGeometry(0.7, 0.7, 8, 32, 1, true),
    new THREE.MeshPhongMaterial({color: 0x00aaff, transparent: true, opacity: 0.2, side: THREE.DoubleSide})
);
tube.position.y = 4;
scene.add(tube);

// 沈む円柱
const target = new THREE.Mesh(
    new THREE.CylinderGeometry(0.6, 0.6, 2, 32),
    new THREE.MeshPhongMaterial({color: 0xffa500})
);
target.position.y = 1; // 地面スレスレ
scene.add(target);

// 鉄球
const ball = new THREE.Mesh(
    new THREE.SphereGeometry(0.5, 32, 32),
    new THREE.MeshPhongMaterial({color: 0x888888, specular: 0xffffff, shininess: 50})
);
scene.add(ball);

camera.position.set(10, 8, 10);
camera.lookAt(0, 3, 0);

// --- Chart.js 設定 ---
const createChartConfig = (xLabel, color) => ({
    type: 'scatter',
    data: { datasets: [{ label: '実験データ', data: [], backgroundColor: color, pointRadius: 5 }] },
    options: {
        scales: {
            x: { type: 'linear', title: { display: true, text: xLabel } },
            y: { title: { display: true, text: '沈み込み距離 (cm)' }, min: 0, max: 15 }
        },
        plugins: { legend: { display: false } }
    }
});
